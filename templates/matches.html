{% extends "base.html" %} {% block content %}
<h2>Matches</h2>
<form class="row g-3 mb-4" method="post" action="{{ url_for('matches.add') }}">
	<div class="col-md-2">
		<select class="form-select" name="game_id" required>
			<option value="">Select Game</option>
			{% for g in games %}
			<option value="{{ g.id }}">{{ g.game_name }}</option>
			{% endfor %}
		</select>
	</div>
	<div class="col-md-3">
		<select class="form-select" name="player_1" required>
			<option value="">Player 1</option>
			{% for p in participants %}
			<option value="{{ p.id }}">{{ p.team_name }}</option>
			{% endfor %}
		</select>
	</div>
	<div class="col-md-3">
		<select class="form-select" name="player_2" required>
			<option value="">Player 2</option>
			{% for p in participants %}
			<option value="{{ p.id }}">{{ p.team_name }}</option>
			{% endfor %}
		</select>
	</div>
	<div class="col-md-2">
		<select class="form-select" name="winner">
			<option value="">Winner</option>
			{% for p in participants %}
			<option value="{{ p.id }}">{{ p.team_name }}</option>
			{% endfor %}
		</select>
	</div>
	<div class="col-md-2">
		<button type="submit" class="btn btn-success w-100">Add</button>
	</div>
</form>

<table class="table table-striped table-hover shadow-sm">
	<thead class="table-primary">
		<tr>
			<th>ID</th>
			<th>Game</th>
			<th>Player 1</th>
			<th>Player 2</th>
			<th>Winner</th>
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>
		{% for m in matches %}
		<tr>
			<td>{{ m.id }}</td>
			<td>{{ m.game.game_name }}</td>
			<td>{{ m.player1.team_name }}</td>
			<td>{{ m.player2.team_name }}</td>
			<td>{{ m.winner_rel.team_name if m.winner_rel else 'None' }}</td>
			<td>
				<button type="button" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#winnerModal{{ m.id }}">Declare</button>
				<a href="{{ url_for('matches.delete', id=m.id) }}" class="btn btn-danger btn-sm">Delete</a>

            </td>
		</tr>
		{% endfor %}
	</tbody>
</table>

{% for m in matches %}
<div class="modal fade" id="winnerModal{{ m.id }}" tabindex="-1" aria-labelledby="winnerModalLabel{{ m.id }}" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<form method="post" action="{{ url_for('matches.update_winner', id=m.id) }}">
				<div class="modal-header">
					<h5 class="modal-title" id="winnerModalLabel{{ m.id }}">Update Winner for Match {{ m.id }}</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<select class="form-select" name="winner" required>
						<option value="">Select Winner</option>
						<option value="{{ m.player1.id }}">{{ m.player1.team_name }}</option>
						<option value="{{ m.player2.id }}">{{ m.player2.team_name }}</option>
						<option value="draw_loss">Both Loss</option>
						<option value="draw_win">Both Win</option>

					</select>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
					<button type="submit" class="btn btn-primary">Save</button>
				</div>
			</form>
		</div>
	</div>
</div>
{% endfor %} {% endblock %}
