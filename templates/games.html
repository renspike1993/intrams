{% extends "base.html" %} {% block content %}
<h2>Games</h2>
<form class="row g-3 mb-4" method="post" action="{{ url_for('games.add') }}">
	<div class="col-md-2">
		<input type="text" class="form-control" name="category" placeholder="Category" required />
	</div>
	<div class="col-md-3">
		<input type="text" class="form-control" name="game_name" placeholder="Game Name" required />
	</div>
	<div class="col-md-3">
		<select class="form-select" name="game_manager" required>
			<option value="">Select Manager</option>
			{% for u in managers %}
			<option value="{{ u.name }}">{{ u.name }}</option>
			{% endfor %}
		</select>
	</div>
	<div class="col-md-3">
		<input type="url" class="form-control" name="live_url" placeholder="Live Stream URL" />
	</div>
	<div class="col-md-1">
		<button type="submit" class="btn btn-success w-100">Add</button>
	</div>
</form>

<table class="table table-striped table-hover shadow-sm">
	<thead class="table-primary">
		<tr>
			<th>ID</th>
			<th>Category</th>
			<th>Game</th>
			<th>Manager</th>
			<th>Live URL</th>
			<th>Actions</th>
		</tr>
	</thead>
	<tbody>
		{% for g in games %}
		<tr>
			<td>{{ g.id }}</td>
			<td>{{ g.category }}</td>
			<td>{{ g.game_name }}</td>
			<td>{{ g.game_manager }}</td>
			<td>
				{% if g.live_url %}
				<a href="{{ g.live_url }}" target="_blank" class="btn btn-link">Watch</a>
				{% else %}
				<span class="text-muted">No link</span>
				{% endif %}
			</td>
			<td>
				<button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editModal{{ g.id }}">Edit</button>
				<a href="{{ url_for('games.delete', id=g.id) }}" class="btn btn-danger btn-sm">Delete</a>
			</td>
		</tr>
		{% for g in games %}
		<div class="modal fade" id="editModal{{ g.id }}" tabindex="-1" aria-labelledby="editModalLabel{{ g.id }}" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<form method="post" action="{{ url_for('games.update', id=g.id) }}">
						<div class="modal-header">
							<h5 class="modal-title" id="editModalLabel{{ g.id }}">Edit Game {{ g.id }}</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body">
							<div class="mb-3">
								<label class="form-label">Category</label>
								<input type="text" class="form-control" name="category" value="{{ g.category }}" required />
							</div>
							<div class="mb-3">
								<label class="form-label">Game Name</label>
								<input type="text" class="form-control" name="game_name" value="{{ g.game_name }}" required />
							</div>
							<div class="mb-3">
								<label class="form-label">Game Manager</label>
                                <select class="form-select" name="game_manager" required>
                                    <option value="">Select Manager</option>
                                    {% for u in managers %}
                                        <option value="{{ u.name }}" {% if g.game_manager == u.name %}selected{% endif %}>{{ u.name }}</option>
                                    {% endfor %}
                                </select>

                            </div>
							<div class="mb-3">
								<label class="form-label">Live URL</label>
								<input type="url" class="form-control" name="live_url" value="{{ g.live_url or '' }}" />
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
							<button type="submit" class="btn btn-primary">Save changes</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		{% endfor %} {% endfor %}
	</tbody>
</table>
{% endblock %}
